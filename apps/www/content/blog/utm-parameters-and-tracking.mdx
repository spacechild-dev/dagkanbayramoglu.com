---
title: UTM Parameters and Tracking with JavaScript
description: This article explains how to capture and store UTM parameters and click IDs using JavaScript for better website visitor analysis.
date: 2024-12-25
author: Dagkan
tags:
  - digital marketing
  - analytics
  - javascript
published: true
---

In digital marketing and performance analysis, tracking parameters like **UTM parameters** and click IDs play a critical role in better understanding website visitors. In this article, I will explain how to store the parameters visible in the address bar during a visitor's first visit and use them later. I will share the full script at the end of the article, but my suggestion is to get support from artificial intelligence and write your own code. Small details may be overlooked, but in this way, it will be easier for you to grasp the logic.

### What is the purpose of the code?

The main purpose of this script is to capture tracking parameters (e.g., utm_source, utm_medium, gclid, fbclid) brought by the URL during the visitor's first visit and store them in local storage (localStorage) and session storage (sessionStorage). Thus, these data are not lost while the user navigates your site and can be used when needed. Otherwise, the tracking parameters appearing in the address bar during the first page visit will be broken during the next page visit.

### How does the script work?

#### 1. We define which parameters we want to track.

At the beginning of the code, you define an array of parameters:

```javascript
const TRACKED_PARAMS = [
  'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'gclid', 'fbclid'
];
```

Here, we preferred the primary UTM parameters and the ad click IDs of the two most frequently used platforms. You can include as many parameters as you want. It is up to you which queries in the URL you want to collect. Suppose you add a parameter "adgroup=generic" to your advertising campaign. When you add 'adgroup' to the area above, you will also store the value corresponding to this query.

`gclid` = Google Click ID
`fbclid` = Facebook Click ID

#### 2. Capture Parameters

When a user comes to the site from a link, the script searches for these parameters in the URL and collects them in an object. Later, we can store them in two different ways and track separate sources.

#### 3. Store with Local Storage for 30 Days

During the first visit, these parameters are stored in `localStorage` for 30 days. This means that when the user enters the site with a campaign link, this information is not lost. After 30 days, it is automatically cleared. If we remove the 30-day limit here, these parameters will be kept in the browser until the user clears the browser data, but since the attribution window of most advertising platforms is 28-30 days, keeping it for this period is useful.

You can set the storage duration in local storage by updating the following line in the script I shared:

```javascript
const EXPIRY_DAYS = 30; // You enter the storage duration in days here.
const LS_EXPIRY_MS = EXPIRY_DAYS * 24 * 60 * 60 * 1000;
// It is calculated in milliseconds in total. Do not make any changes in the 2nd line.
```

#### 4. Store with Session Storage for the Session

In addition, parameters are also written to `sessionStorage`. This way, parameters are easily accessible until the user closes the tab. The parameters found first are stored again in each new session. Here, you can set up a special tracking system to compare the first and last sessions.

#### 5. Easy Access with JavaScript

If you wish, you can access the captured parameters from other scripts with `window.trackingParams`.

```javascript
console.log(window.trackingParams);
```

### Where can you use this script?

Form pre-filling: You can automatically fill in campaign information for the user in registration or contact forms. I will share an article about this soon.

Analytics integration: You can use it to send your own tracking parameters to tools like Google Analytics, Facebook Pixel.

Personalized content: You can display personalized content on your website based on the traffic source or campaign parameters the user came from. Thanks to A/B testing, personalization and CRO (Conversion Rate Optimization) tools, it is possible to offer special messages and campaign offers to each visitor. In this way, you can improve the user experience and increase your conversion rates.

The full code you will add to `<body>...</body>`:

```html
<script>
(function trackUrlParams() {
    const TRACKED_PARAMS = [
        'utm_source',
        'utm_medium',
        'utm_campaign',
        'utm_term',
        'utm_content',
        'gclid',
        'fbclid'
    ];
    const searchParams = new URLSearchParams(window.location.search);
    let foundParams = {};
    for (const key of TRACKED_PARAMS) {
        if (searchParams.has(key)) {
            foundParams[key] = searchParams.get(key);
        }
    }
    const LS_KEY = 'trackingParams';
    const LS_EXP_KEY = 'trackingParams_expiry';
    const now = Date.now();
    const EXPIRY_DAYS = 30; // Storage duration (days)
    const LS_EXPIRY_MS = EXPIRY_DAYS * 24 * 60 * 60 * 1000;
    if (Object.keys(foundParams).length > 0) {
        if (!localStorage.getItem(LS_KEY) || Number(localStorage.getItem(LS_EXP_KEY)) < now) {
            localStorage.setItem(LS_KEY, JSON.stringify(foundParams));
            localStorage.setItem(LS_EXP_KEY, now + LS_EXPIRY_MS);
        }
    } else {
        const exp = Number(localStorage.getItem(LS_EXP_KEY));
        if (exp && exp < now) {
            localStorage.removeItem(LS_KEY);
            localStorage.removeItem(LS_EXP_KEY);
        }
    }
    if (Object.keys(foundParams).length > 0) {
        sessionStorage.setItem(LS_KEY, JSON.stringify(foundParams));
    } else {
        sessionStorage.removeItem(LS_KEY);
    }
    window.trackingParams = foundParams;
})();
</script>
```

Custom HTML code you can use in Google Tag Manager:

```html
<script>
(function trackUrlParams() {
    var TRACKED_PARAMS = [
        'utm_source',
        'utm_medium',
        'utm_campaign',
        'utm_term',
        'utm_content',
        'gclid',
        'fbclid'
    ];
    // Classic method instead of URLSearchParams:
    function getQueryParams() {
        var params = {};
        var query = window.location.search.substring(1);
        var pairs = query.split('&');
        var i; // Declare i here
        for (i = 0; i < pairs.length; i++) {
            var pair = pairs[i].split('=');
            if (pair[0]) {
                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }
        }
        return params;
    }
    var searchParams = getQueryParams();
    var foundParams = {};
    for (var i = 0; i < TRACKED_PARAMS.length; i++) {
        var key = TRACKED_PARAMS[i];
        if (searchParams.hasOwnProperty(key)) {
            foundParams[key] = searchParams[key];
        }
    }
    var LS_KEY = 'trackingParams';
    var LS_EXP_KEY = 'trackingParams_expiry';
    var now = (new Date()).getTime();
    var EXPIRY_DAYS = 30; // Storage duration (days)
    var LS_EXPIRY_MS = EXPIRY_DAYS * 24 * 60 * 60 * 1000;
    if (Object.keys(foundParams).length > 0) {
        if (!localStorage.getItem(LS_KEY) || Number(localStorage.getItem(LS_EXP_KEY)) < now) {
            localStorage.setItem(LS_KEY, JSON.stringify(foundParams));
            localStorage.setItem(LS_EXP_KEY, now + LS_EXPIRY_MS);
        }
    } else {
        var exp = Number(localStorage.getItem(LS_EXP_KEY));
        if (exp && exp < now) {
            localStorage.removeItem(LS_KEY);
            localStorage.removeItem(LS_EXP_KEY);
        }
    }
    if (Object.keys(foundParams).length > 0) {
        sessionStorage.setItem(LS_KEY, JSON.stringify(foundParams));
    } else {
        sessionStorage.removeItem(LS_KEY);
    }
    window.trackingParams = foundParams;
})();
</script>